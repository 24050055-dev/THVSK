<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sống Khỏe Pro - Fitness & Lifestyle</title>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --primary: #1a4d2e; /* Xanh rừng đậm */
            --primary-light: #4f9a68;
            --accent: #ff9f1c; /* Cam tạo điểm nhấn */
            --dark: #1f2937;
            --light: #f3f4f6;
            --white: #ffffff;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --radius: 12px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }

        body {
            background-color: var(--light);
            color: var(--dark);
            line-height: 1.6;
        }

        /* --- HEADER & NAV --- */
        header {
            background-color: var(--white);
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 700;
            font-size: 1.5rem;
            color: var(--primary);
            text-decoration: none;
        }

        .logo i {
            font-size: 1.8rem;
            color: var(--accent);
        }

        nav ul {
            display: flex;
            list-style: none;
            gap: 20px;
            align-items: center;
        }

        nav a {
            text-decoration: none;
            color: var(--dark);
            font-weight: 500;
            transition: 0.3s;
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.95rem;
        }

        nav a:hover, nav a.active {
            color: var(--primary);
        }

        .cart-btn {
            position: relative;
        }

        .badge {
            position: absolute;
            top: -8px;
            right: -10px;
            background: var(--accent);
            color: white;
            font-size: 0.7rem;
            padding: 2px 6px;
            border-radius: 50%;
        }

        /* --- SECTIONS COMMON --- */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            min-height: 80vh;
        }

        .section {
            display: none;
            animation: fadeEffect 0.5s;
        }

        .section.active {
            display: block;
        }

        @keyframes fadeEffect {
            from {opacity: 0; transform: translateY(20px);}
            to {opacity: 1; transform: translateY(0);}
        }

        h2 {
            color: var(--primary);
            margin-bottom: 25px;
            font-size: 2rem;
            position: relative;
            display: inline-block;
        }
        
        h2::after {
            content: '';
            display: block;
            width: 50%;
            height: 4px;
            background: var(--accent);
            margin-top: 5px;
            border-radius: 2px;
        }

        /* --- BUTTONS --- */
        .btn {
            padding: 10px 24px;
            border: none;
            border-radius: 30px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
            box-shadow: 0 4px 15px rgba(26, 77, 46, 0.3);
        }

        .btn-primary:hover {
            background: #143d24;
            transform: translateY(-2px);
        }

        .btn-outline {
            border: 2px solid var(--primary);
            color: var(--primary);
            background: transparent;
        }

        .btn-outline:hover {
            background: var(--primary);
            color: white;
        }

        .btn-danger {
            background: #e74c3c;
            color: white;
        }

        /* --- HOME: ADS & BANNERS --- */
        .hero-slider {
            position: relative;
            height: 400px;
            border-radius: var(--radius);
            overflow: hidden;
            margin-bottom: 40px;
            box-shadow: var(--shadow);
        }

        .slide {
            position: absolute;
            width: 100%;
            height: 100%;
            display: none;
        }

        .slide.active {
            display: block;
        }

        .slide img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .slide-content {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            background: linear-gradient(to top, rgba(0,0,0,0.8), transparent);
            color: white;
            padding: 40px 30px;
        }

        .ads-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .ad-card {
            background: white;
            border-radius: var(--radius);
            overflow: hidden;
            box-shadow: var(--shadow);
            position: relative;
        }
        
        .ad-card img {
            width: 100%;
            height: 200px;
            object-fit: cover;
        }
        
        .ad-badge {
            position: absolute;
            top: 10px;
            left: 10px;
            background: var(--accent);
            color: white;
            padding: 5px 10px;
            font-size: 0.8rem;
            font-weight: bold;
            border-radius: 4px;
        }

        /* --- BMI SECTION --- */
        .bmi-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
            background: white;
            padding: 40px;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
        }

        .bmi-form h3 { margin-bottom: 20px; color: var(--dark); }
        
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: 500; }
        .form-group input {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
        }

        .bmi-result {
            background: var(--light);
            padding: 20px;
            border-radius: var(--radius);
            text-align: center;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .bmi-score {
            font-size: 4rem;
            font-weight: 700;
            color: var(--primary);
            line-height: 1;
        }

        .bmi-status {
            font-size: 1.5rem;
            font-weight: 600;
            margin: 10px 0;
        }

        .suggestion-box {
            margin-top: 30px;
            border-top: 1px solid #ddd;
            padding-top: 20px;
        }
        
        .suggestion-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        /* --- WORKOUT SECTION --- */
        .workout-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .workout-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 25px;
        }

        .video-card {
            background: white;
            border-radius: var(--radius);
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: transform 0.3s;
        }

        .video-card:hover { transform: translateY(-5px); }

        .video-thumb {
            position: relative;
            padding-bottom: 56.25%; /* 16:9 */
            background: #000;
            cursor: pointer;
        }
        
        /* Container để chứa iframe hoặc video khi đã play */
        .video-player-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 10;
        }

        .video-info { padding: 15px; }
        .video-tag {
            display: inline-block;
            padding: 4px 8px;
            background: var(--light);
            color: var(--primary);
            font-size: 0.8rem;
            border-radius: 4px;
            margin-bottom: 5px;
        }

        /* --- SHOP SECTION --- */
        .shop-controls {
            display: flex;
            justify-content: space-between;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 25px;
        }

        .product-card {
            background: white;
            border-radius: var(--radius);
            padding: 15px;
            text-align: center;
            box-shadow: var(--shadow);
            transition: 0.3s;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .product-card:hover {
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }

        .product-card img {
            width: 100%;
            height: 180px;
            object-fit: contain;
            margin-bottom: 15px;
        }

        .price-tag {
            color: var(--accent);
            font-weight: 700;
            font-size: 1.1rem;
            margin: 10px 0;
            display: block;
        }

        /* --- AUTH --- */
        .auth-wrapper {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 60vh;
        }

        .auth-card {
            background: white;
            padding: 40px;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            width: 100%;
            max-width: 400px;
            text-align: center;
        }

        /* --- RESPONSIVE --- */
        @media (max-width: 768px) {
            .nav-container { flex-direction: column; gap: 15px; }
            nav ul { width: 100%; justify-content: center; flex-wrap: wrap; gap: 10px; }
            .bmi-container { grid-template-columns: 1fr; }
            .hero-slider { height: 250px; }
        }
    </style>
</head>
<body>

<!-- NAVIGATION -->
<header>
    <div class="nav-container">
        <a href="#" class="logo" onclick="showPage('home')">
            <i class="fas fa-dumbbell"></i> SỐNG KHỎE PRO
        </a>
        <nav>
            <ul>
                <li id="menu-home" style="display:none"><a href="#" onclick="showPage('home')">Trang chủ</a></li>
                <li id="menu-workout" style="display:none"><a href="#" onclick="showPage('workout')">Tập luyện</a></li>
                <li id="menu-bmi" style="display:none"><a href="#" onclick="showPage('bmi')">BMI & Lộ trình</a></li>
                <li id="menu-shop" style="display:none"><a href="#" onclick="showPage('shop')">Cửa hàng</a></li>
                <li id="menu-cart" style="display:none">
                    <a href="#" onclick="showPage('cart')" class="cart-btn">
                        <i class="fas fa-shopping-cart"></i>
                        <span id="cart-count" class="badge">0</span>
                    </a>
                </li>
                <!-- Login/User -->
                <li id="menu-login">
                    <a href="#" onclick="showPage('login')" class="btn btn-primary" style="padding: 5px 15px; color: white;">Đăng nhập</a>
                </li>
                <li id="menu-user" style="display:none">
                    <a href="#" onclick="handleLogout()" style="color: var(--danger);">
                        <i class="fas fa-sign-out-alt"></i> <span id="user-name-display">User</span>
                    </a>
                </li>
            </ul>
        </nav>
    </div>
</header>

<div class="container">

    <!-- 1. LOGIN SECTION -->
    <div id="login" class="section active">
        <div class="auth-wrapper">
            <div class="auth-card">
                <h2 id="auth-title">Chào mừng trở lại</h2>
                <div id="auth-error" style="color:red; margin-bottom:15px; font-size:0.9rem;"></div>
                
                <div class="form-group" id="group-name" style="display:none;">
                    <input type="text" id="reg-name" placeholder="Họ và tên">
                </div>
                <div class="form-group">
                    <input type="text" id="login-user" placeholder="Tên đăng nhập / Email">
                </div>
                <div class="form-group">
                    <input type="password" id="login-pass" placeholder="Mật khẩu">
                </div>

                <button class="btn btn-primary" style="width:100%" onclick="handleAuth()" id="auth-btn">ĐĂNG NHẬP</button>
                
                <p style="margin-top:20px; font-size:0.9rem;">
                    <span id="auth-switch-text">Chưa có tài khoản?</span> 
                    <a href="#" onclick="toggleAuthMode()" style="color:var(--primary); font-weight:bold;" id="auth-switch-link">Đăng ký ngay</a>
                </p>
            </div>
        </div>
    </div>

    <!-- 2. HOME SECTION -->
    <div id="home" class="section">
        <!-- Hero Slider (Quảng cáo) -->
        <div class="hero-slider">
            <div class="slide active">
                <img src="https://images.unsplash.com/photo-1534438327276-14e5300c3a48?w=1200&q=80" alt="Gym">
                <div class="slide-content">
                    <h1>Khởi động ngày mới đầy năng lượng</h1>
                    <p>Giảm giá 50% dụng cụ tập luyện trong tháng này.</p>
                </div>
            </div>
            <div class="slide">
                <img src="https://images.unsplash.com/photo-1517836357463-d25dfeac3438?w=1200&q=80" alt="Cardio">
                <div class="slide-content">
                    <h1>Lộ trình giảm cân chuyên sâu</h1>
                    <p>Tham gia ngay khóa học Cardio đốt mỡ tại nhà.</p>
                </div>
            </div>
            <div class="slide">
                <img src="https://images.unsplash.com/photo-1599901860904-17e6ed7083a0?w=1200&q=80" alt="Supplement">
                <div class="slide-content">
                    <h1>Whey Protein chính hãng</h1>
                    <p>Mua 1 tặng 1 cho thành viên mới.</p>
                </div>
            </div>
        </div>

        <!-- Ads Grid -->
        <h2>Ưu đãi nổi bật</h2>
        <div class="ads-grid">
            <div class="ad-card" onclick="showPage('shop')">
                <span class="ad-badge">HOT</span>
                <img src="https://images.unsplash.com/photo-1593095948071-474c5cc2989d?w=500" alt="Ad 1">
                <div style="padding:15px;">
                    <h3>Combo Tập Tại Nhà</h3>
                    <p style="color:#666">Chỉ từ 299k trọn bộ dây kháng lực.</p>
                </div>
            </div>
            <div class="ad-card" onclick="showPage('workout')">
                <span class="ad-badge">FREE</span>
                <img src="https://images.unsplash.com/photo-1571019614242-c5c5dee9f50b?w=500" alt="Ad 2">
                <div style="padding:15px;">
                    <h3>Thử thách 7 ngày</h3>
                    <p style="color:#666">Tham gia thử thách giảm eo miễn phí.</p>
                </div>
            </div>
            <div class="ad-card" onclick="showPage('shop')">
                <span class="ad-badge">-30%</span>
                <img src="https://images.unsplash.com/photo-1584735935682-2f2b69dff9d2?w=500" alt="Ad 3">
                <div style="padding:15px;">
                    <h3>Thực phẩm bổ sung</h3>
                    <p style="color:#666">Vitamin và khoáng chất thiết yếu.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- 3. WORKOUT SECTION -->
    <div id="workout" class="section">
        <h2>Thư viện bài tập</h2>
        <div class="workout-tabs">
            <button class="btn btn-outline" onclick="filterWorkout('all')">Tất cả</button>
            <button class="btn btn-outline" onclick="filterWorkout('giam-can')">Cardio Giảm Mỡ</button>
            <button class="btn btn-outline" onclick="filterWorkout('tang-co')">Gym Tăng Cơ</button>
            <button class="btn btn-outline" onclick="filterWorkout('yoga')">Yoga Dẻo Dai</button>
        </div>
        <div id="workout-grid" class="workout-grid">
            <!-- Render by JS -->
        </div>
    </div>

    <!-- 4. BMI SECTION -->
    <div id="bmi" class="section">
        <h2>Tính chỉ số BMI & Lộ trình</h2>
        <p style="margin-bottom: 20px;">Nhập thông tin để nhận gợi ý bài tập phù hợp nhất với thể trạng của bạn.</p>
        
        <div class="bmi-container">
            <div class="bmi-form">
                <h3>Thông tin cơ thể</h3>
                <div class="form-group">
                    <label>Giới tính</label>
                    <div style="display:flex; gap:20px;">
                        <label><input type="radio" name="gender" checked> Nam</label>
                        <label><input type="radio" name="gender"> Nữ</label>
                    </div>
                </div>
                <div class="form-group">
                    <label>Chiều cao (cm)</label>
                    <input type="number" id="bmi-height" placeholder="Ví dụ: 170">
                </div>
                <div class="form-group">
                    <label>Cân nặng (kg)</label>
                    <input type="number" id="bmi-weight" placeholder="Ví dụ: 65">
                </div>
                <button class="btn btn-primary" style="width:100%" onclick="calculateBMI()">TÍNH NGAY</button>
            </div>

            <div class="bmi-result">
                <h3>Kết quả của bạn</h3>
                <div class="bmi-score" id="bmi-val">--</div>
                <div class="bmi-status" id="bmi-text">Chưa có dữ liệu</div>
                <p id="bmi-advice" style="font-size: 0.9rem; color: #666;">Vui lòng nhập chiều cao và cân nặng.</p>
            </div>
        </div>

        <div id="bmi-suggestions" class="suggestion-box" style="display:none">
            <h3><i class="fas fa-bullseye" style="color:var(--accent)"></i> Bài tập đề xuất cho bạn</h3>
            <div class="suggestion-cards" id="suggested-exercises">
                <!-- Render suggested exercises here -->
            </div>
        </div>
    </div>

    <!-- 5. SHOP SECTION -->
    <div id="shop" class="section">
        <h2>Cửa hàng dụng cụ</h2>
        <div class="shop-controls">
            <div class="workout-tabs">
                <button class="btn btn-outline" onclick="filterShop('all')">Tất cả</button>
                <button class="btn btn-outline" onclick="filterShop('accessory')">Dụng cụ</button>
                <button class="btn btn-outline" onclick="filterShop('supplement')">Thực phẩm</button>
            </div>
            <input type="text" placeholder="Tìm kiếm..." style="padding:10px; border-radius:20px; border:1px solid #ddd; width: 250px;" onkeyup="searchProduct(this.value)">
        </div>
        <div id="shop-grid" class="product-grid">
            <!-- Render JS -->
        </div>
    </div>

    <!-- 6. CART SECTION -->
    <div id="cart" class="section">
        <h2>Giỏ hàng (<span id="cart-total-count">0</span>)</h2>
        <div id="cart-items" style="background:white; padding:20px; border-radius:var(--radius); box-shadow:var(--shadow);">
            <p style="text-align:center; color:#888;">Giỏ hàng trống</p>
        </div>
        <div style="margin-top:20px; text-align:right;">
            <h3>Tổng tiền: <span id="cart-total-price" style="color:var(--accent)">0 đ</span></h3>
            <button class="btn btn-primary" onclick="checkout()" style="margin-top:10px;">Thanh toán</button>
        </div>
    </div>

</div>

<script>
    // --- DATA ---
    const products = [
        { id: 1, name: "Thảm Yoga Định Tuyến", price: 350000, type: "accessory", img: "https://images.unsplash.com/photo-1601925260368-ae2f83cf8b7f?w=500" },
        { id: 2, name: "Whey Protein Isolate", price: 1200000, type: "supplement", img: "https://images.unsplash.com/photo-1593095948071-474c5cc2989d?w=500" },
        { id: 3, name: "Bộ Dây Kháng Lực", price: 150000, type: "accessory", img: "https://images.unsplash.com/photo-1598289431512-b97b0917affc?w=500" },
        { id: 4, name: "Tạ Tay Đa Năng 10kg", price: 250000, type: "accessory", img: "https://images.unsplash.com/photo-1583454110551-21f2fa2afe61?w=500" },
        { id: 5, name: "BCAAs Phục Hồi Cơ", price: 600000, type: "supplement", img: "https://images.unsplash.com/photo-1593095948071-474c5cc2989d?w=500" },
        { id: 6, name: "Con Lăn Tập Bụng", price: 180000, type: "accessory", img: "https://images.unsplash.com/photo-1517836357463-d25dfeac3438?w=500" }
    ];

    // --- VIDEO DATA (Hỗ trợ cả YouTube & File MP4) ---
    const workouts = [
        // YouTube: dùng ID (dãy ký tự sau v=)
        { id: 1, title: "Cardio Đốt Mỡ 15p", group: "giam-can", tags: ["Sơ cấp", "Không dụng cụ"], videoId: "M0uO8X3_tEA", img: "https://images.unsplash.com/photo-1517836357463-d25dfeac3438?w=500" }, 
        
        // Demo File MP4 trực tiếp (từ nguồn công cộng để test)
        { id: 2, title: "Yoga tại nhà", group: "yoga", tags: ["Thư giãn", "Demo File"], videoId: "M6htajcXuNeVRRkT", img: "yoga.jpg" }, 
        
        // Các bài tập khác (YouTube)
        { id: 3, title: "Tập Ngực Tại Nhà", group: "tang-co", tags: ["Trung cấp", "Tạ tay"], videoId: "8D9lE8d7jkU", img: "https://images.unsplash.com/photo-1581009146145-b5ef050c2e1e?w=500" }, 
        { id: 4, title: "HIIT Cường Độ Cao", group: "giam-can", tags: ["Nâng cao", "Đốt mỡ"], videoId: "Op1tU8_j6wM", img: "https://images.unsplash.com/photo-1434682881908-b43d0467b798?w=500" }, 
        { id: 5, title: "Squat Mông Đùi", group: "tang-co", tags: ["Cơ bản", "Chân"], videoId: "ntQe6l-iU8A", img: "https://images.unsplash.com/photo-1574680096145-d05b474e2155?w=500" }, 
        { id: 6, title: "Yoga Trị Liệu Lưng", group: "yoga", tags: ["Phục hồi"], videoId: "XeXz8fIZDCE", img: "https://images.unsplash.com/photo-1599901860904-17e6ed7083a0?w=500" } 
    ];

    let cart = [];
    let currentUser = null;
    let isRegistering = false;

    // --- INIT ---
    window.onload = () => {
        const storedUser = localStorage.getItem('user');
        if (storedUser) {
            currentUser = storedUser;
            updateAuthUI();
            showPage('home');
        } else {
            showPage('login');
        }
        
        renderShop(products);
        renderWorkouts(workouts);
        startSlider();
    };

    // --- NAVIGATION ---
    function showPage(pageId) {
        document.querySelectorAll('.section').forEach(el => el.classList.remove('active'));
        document.getElementById(pageId).classList.add('active');
        
        document.querySelectorAll('nav a').forEach(el => el.classList.remove('active'));
        // Highlight active nav logic (optional)
        
        if (pageId === 'cart') renderCart();
    }

    // --- AUTH LOGIC ---
    function toggleAuthMode() {
        isRegistering = !isRegistering;
        const title = document.getElementById('auth-title');
        const btn = document.getElementById('auth-btn');
        const switchText = document.getElementById('auth-switch-text');
        const switchLink = document.getElementById('auth-switch-link');
        const nameGroup = document.getElementById('group-name');

        if(isRegistering) {
            title.innerText = "Tạo tài khoản mới";
            btn.innerText = "ĐĂNG KÝ";
            switchText.innerText = "Đã có tài khoản?";
            switchLink.innerText = "Đăng nhập";
            nameGroup.style.display = "block";
        } else {
            title.innerText = "Chào mừng trở lại";
            btn.innerText = "ĐĂNG NHẬP";
            switchText.innerText = "Chưa có tài khoản?";
            switchLink.innerText = "Đăng ký ngay";
            nameGroup.style.display = "none";
        }
        document.getElementById('auth-error').innerText = "";
    }

    function handleAuth() {
        const user = document.getElementById('login-user').value;
        const pass = document.getElementById('login-pass').value;
        const error = document.getElementById('auth-error');

        if(!user || !pass) {
            error.innerText = "Vui lòng nhập đầy đủ thông tin";
            return;
        }

        if(isRegistering) {
            const name = document.getElementById('reg-name').value;
            if(!name) { error.innerText = "Vui lòng nhập họ tên"; return; }
            currentUser = name; // Giả lập đăng ký thành công
            alert("Đăng ký thành công!");
        } else {
            currentUser = user.split('@')[0]; // Giả lập lấy tên từ email/user
        }

        localStorage.setItem('user', currentUser);
        updateAuthUI();
        showPage('home');
    }

    function handleLogout() {
        localStorage.removeItem('user');
        currentUser = null;
        updateAuthUI();
        showPage('login');
    }

    function updateAuthUI() {
        const loggedIn = !!currentUser;
        document.getElementById('menu-home').style.display = loggedIn ? 'block' : 'none';
        document.getElementById('menu-workout').style.display = loggedIn ? 'block' : 'none';
        document.getElementById('menu-bmi').style.display = loggedIn ? 'block' : 'none';
        document.getElementById('menu-shop').style.display = loggedIn ? 'block' : 'none';
        document.getElementById('menu-cart').style.display = loggedIn ? 'block' : 'none';
        
        document.getElementById('menu-login').style.display = loggedIn ? 'none' : 'block';
        document.getElementById('menu-user').style.display = loggedIn ? 'block' : 'none';
        
        if(loggedIn) document.getElementById('user-name-display').innerText = currentUser;
    }

    // --- SLIDER LOGIC ---
    function startSlider() {
        let index = 0;
        const slides = document.querySelectorAll('.slide');
        if(slides.length === 0) return;
        
        setInterval(() => {
            slides[index].classList.remove('active');
            index = (index + 1) % slides.length;
            slides[index].classList.add('active');
        }, 4000);
    }

    // --- WORKOUT LOGIC (PLAY VIDEO TRỰC TIẾP) ---
    function renderWorkouts(list) {
        const grid = document.getElementById('workout-grid');
        grid.innerHTML = list.map(v => `
            <div class="video-card">
                <div class="video-thumb" onclick="playVideo(${v.id}, '${v.videoId}')" id="video-container-${v.id}">
                    <img src="${v.img}" style="width:100%; height:100%; object-fit:cover; position:absolute;">
                    <i class="fas fa-play-circle" style="position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); font-size:3rem; color:white; opacity:0.8; transition:0.3s;"></i>
                </div>
                <div class="video-info">
                    <div style="margin-bottom:10px;">
                        ${v.tags.map(t => `<span class="video-tag">${t}</span>`).join('')}
                    </div>
                    <h3>${v.title}</h3>
                    <p style="color:#666; font-size:0.9rem;">Nhóm: ${getGroupName(v.group)}</p>
                    <button id="btn-play-${v.id}" class="btn btn-outline" style="margin-top:10px; width:100%" onclick="playVideo(${v.id}, '${v.videoId}')">Xem ngay</button>
                </div>
            </div>
        `).join('');
    }

    // HÀM XỬ LÝ PHÁT VIDEO THÔNG MINH
    function playVideo(id, videoKey) {
        const container = document.getElementById(`video-container-${id}`);
        const btn = document.getElementById(`btn-play-${id}`);
        
        // Kiểm tra xem video có đang phát chưa để tránh load lại
        if(container.querySelector('iframe') || container.querySelector('video')) {
            return; // Đang phát rồi thì thôi
        }

        let videoHTML = '';
        
        // 1. Nếu là file .mp4 (File trực tiếp)
        if(videoKey.includes('.mp4') || videoKey.includes('.webm')) {
            videoHTML = `
                <div class="video-player-container">
                    <video width="100%" height="100%" controls autoplay style="background:black">
                        <source src="${videoKey}" type="video/mp4">
                        Trình duyệt không hỗ trợ.
                    </video>
                </div>
            `;
        } 
        // 2. Nếu là YouTube ID (Phổ biến nhất)
        else {
            videoHTML = `
                <div class="video-player-container">
                    <iframe width="100%" height="100%" 
                        src="https://www.youtube.com/embed/${videoKey}?autoplay=1&rel=0" 
                        frameborder="0" 
                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                        allowfullscreen>
                    </iframe>
                </div>
            `;
        }
        
        container.innerHTML = videoHTML;
        container.onclick = null; // Bỏ sự kiện click để không bị conflict
        
        // Cập nhật nút bấm cho chuyên nghiệp
        if(btn) {
            btn.innerText = "Đang phát...";
            btn.style.background = "#eee";
            btn.style.color = "#888";
            btn.style.border = "none";
        }
    }

    function getGroupName(key) {
        if(key === 'giam-can') return 'Giảm cân & Cardio';
        if(key === 'tang-co') return 'Gym & Tăng cơ';
        if(key === 'yoga') return 'Yoga & Giãn cơ';
        return 'Tổng hợp';
    }

    function filterWorkout(type) {
        if(type === 'all') renderWorkouts(workouts);
        else renderWorkouts(workouts.filter(w => w.group === type));
    }

    // --- BMI LOGIC ---
    function calculateBMI() {
        const h = parseFloat(document.getElementById('bmi-height').value);
        const w = parseFloat(document.getElementById('bmi-weight').value);
        
        if(!h || !w) { alert("Vui lòng nhập số hợp lệ"); return; }

        const bmi = (w / ((h/100) ** 2)).toFixed(1);
        let status = "";
        let color = "";
        let suggestGroup = "";
        let advice = "";

        if (bmi < 18.5) {
            status = "Thiếu cân"; color = "#3498db"; suggestGroup = "tang-co";
            advice = "Bạn cần tăng cường dinh dưỡng và tập các bài Gym để tăng cơ bắp.";
        } else if (bmi < 24.9) {
            status = "Bình thường"; color = "#2ecc71"; suggestGroup = "yoga"; 
            advice = "Tuyệt vời! Hãy duy trì tập Yoga hoặc Gym nhẹ để giữ dáng.";
        } else if (bmi < 29.9) {
            status = "Thừa cân"; color = "#f39c12"; suggestGroup = "giam-can";
            advice = "Bạn nên tập trung vào Cardio và HIIT để đốt mỡ thừa.";
        } else {
            status = "Béo phì"; color = "#e74c3c"; suggestGroup = "giam-can";
            advice = "Cảnh báo! Cần chế độ ăn kiêng và tập Cardio cường độ thấp ngay.";
        }

        // Render Result
        document.getElementById('bmi-val').innerText = bmi;
        document.getElementById('bmi-val').style.color = color;
        document.getElementById('bmi-text').innerText = status;
        document.getElementById('bmi-text').style.color = color;
        document.getElementById('bmi-advice').innerText = advice;

        // Render Suggestions
        document.getElementById('bmi-suggestions').style.display = 'block';
        const suggestedList = workouts.filter(w => w.group === suggestGroup || w.group === 'yoga').slice(0, 3);
        
        const sugGrid = document.getElementById('suggested-exercises');
        sugGrid.innerHTML = suggestedList.map(v => `
            <div style="border:1px solid #eee; border-radius:8px; padding:10px; cursor:pointer;" onclick="showPage('workout')">
                <img src="${v.img}" style="width:100%; height:120px; object-fit:cover; border-radius:4px;">
                <h4 style="margin-top:5px; font-size:0.9rem;">${v.title}</h4>
                <span style="font-size:0.8rem; color:${color}">Đề xuất cho bạn</span>
            </div>
        `).join('');
    }

    // --- SHOP LOGIC ---
    function renderShop(list) {
        const grid = document.getElementById('shop-grid');
        grid.innerHTML = list.map(p => `
            <div class="product-card">
                <img src="${p.img}" alt="${p.name}">
                <div>
                    <h4>${p.name}</h4>
                    <span class="price-tag">${p.price.toLocaleString()} đ</span>
                    <button class="btn btn-outline" style="width:100%" onclick="addToCart(${p.id})">Thêm vào giỏ</button>
                </div>
            </div>
        `).join('');
    }

    function filterShop(type) {
        if(type === 'all') renderShop(products);
        else renderShop(products.filter(p => p.type === type));
    }

    function searchProduct(keyword) {
        const filtered = products.filter(p => p.name.toLowerCase().includes(keyword.toLowerCase()));
        renderShop(filtered);
    }

    // --- CART LOGIC ---
    function addToCart(id) {
        const prod = products.find(p => p.id === id);
        const exist = cart.find(i => i.id === id);
        if(exist) exist.qty++;
        else cart.push({...prod, qty: 1});
        updateCartCount();
        alert("Đã thêm vào giỏ hàng!");
    }

    function updateCartCount() {
        const count = cart.reduce((sum, i) => sum + i.qty, 0);
        document.getElementById('cart-count').innerText = count;
        document.getElementById('cart-total-count').innerText = count;
    }

    function renderCart() {
        const container = document.getElementById('cart-items');
        if(cart.length === 0) {
            container.innerHTML = '<p style="text-align:center; color:#888;">Giỏ hàng trống</p>';
            document.getElementById('cart-total-price').innerText = "0 đ";
            return;
        }

        let total = 0;
        container.innerHTML = cart.map((item, idx) => {
            total += item.price * item.qty;
            return `
            <div style="display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid #eee; padding:10px 0;">
                <div style="display:flex; align-items:center; gap:10px;">
                    <img src="${item.img}" style="width:50px; height:50px; object-fit:cover; border-radius:4px;">
                    <div>
                        <strong>${item.name}</strong><br>
                        <small>${item.price.toLocaleString()}đ x ${item.qty}</small>
                    </div>
                </div>
                <button class="btn btn-danger" style="padding:5px 10px; font-size:0.8rem;" onclick="removeFromCart(${idx})">Xóa</button>
            </div>`;
        }).join('');
        
        document.getElementById('cart-total-price').innerText = total.toLocaleString() + " đ";
    }

    function removeFromCart(idx) {
        cart.splice(idx, 1);
        updateCartCount();
        renderCart();
    }

    function checkout() {
        if(cart.length === 0) return alert("Giỏ hàng trống!");
        if(confirm(`Xác nhận thanh toán ${document.getElementById('cart-total-price').innerText}?`)) {
            alert("Đặt hàng thành công! Cảm ơn bạn.");
            cart = [];
            updateCartCount();
            renderCart();
        }
    }
</script>

</body>
</html>